!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("moment"),require("underscore")):"function"==typeof define&&define.amd?define(["moment","underscore"],t):"object"==typeof exports?exports.FormulaValue=t(require("moment"),require("underscore")):e.FormulaValue=t(e.moment,e.underscore)}(window,function(__WEBPACK_EXTERNAL_MODULE__4__,__WEBPACK_EXTERNAL_MODULE__5__){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=7)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,[{key:"eval",value:function(){throw new Error("Eval is not implemented")}}]),e}();t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a=r(5),o=(n=a)&&n.__esModule?n:{default:n};var u=function(e){if(!e)return[];for(var t=e.split(/\.|::/),r=[];t.length>0;){var n=t.shift();(n=n.replace(/(.*)\[(@|\*|\d+)]/g,function(e,t,n){return r.push(t),"@"!==n&&"*"!==n&&(n=Number(n)),r.push(n),""}))&&r.push(n)}return r};t.default={getPath:u,assignTo:function(e,t,r,n){var a=u(t);for(void 0!==r&&a.push(r);a.length;){var o=a.shift();if(a.length>0){if(!e[o]){var i=a[0];e[o]="number"==typeof i?[]:{}}e=e[o]}else e[o]=n}},compact:function(e,t){for(var r=u(t);r.length;){var n=r.shift();if(r.length>0){if(!e[n]){var a=r[0];e[n]="number"==typeof a?[]:{}}e=e[n]}else e[n]=o.default.compact(e[n])}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0),u=(n=o)&&n.__esModule?n:{default:n};var i=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.value=e,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.default),a(t,[{key:"eval",value:function(){return this.value}}]),t}();t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=(o(r(1)),o(r(0)));function o(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),n(t,null,[{key:"isConcatenatedText",value:function(e){return"string"==typeof e}}]),t}();t.default=u},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE__4__},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE__5__},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_CompiledExpression2=__webpack_require__(0),_CompiledExpression3=_interopRequireDefault(_CompiledExpression2),_Helpers=__webpack_require__(1),_Helpers2=_interopRequireDefault(_Helpers),_moment=__webpack_require__(4),_moment2=_interopRequireDefault(_moment);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var dataVarName="data",metaDataVarName="metaData",fieldPathsVarName="__fieldPaths",variablePattern="{{([^}]+)}}",getDateTimeFormat=function(e){if(!e||"string"!=typeof e)return"";switch(e.length){case 10:return"YYYY-MM-DD";case 19:return"YYYY-MM-DD HH:mm:ss";case 8:return"HH:mm:ss";default:return""}},validateOperation=function(e,t,r){switch(r){case"years":case"months":case"weeks":case"days":if("HH:mm:ss"===e||"HH:mm:ss"===t)return!1;break;case"hours":case"minutes":case"seconds":if(("HH:mm:ss"===e||"HH:mm:ss"===t)&&e!==t)return!1}return!0},evalWithSafeEnvironment=function(){var __availableSpecs={Y:"years",M:"months",W:"weeks",D:"days",h:"hours",m:"minutes",s:"seconds",years:"years",months:"months",weeks:"weeks",days:"days",hours:"hours",minutes:"minutes",seconds:"seconds"},__defaultSpec="seconds",__processStarOperator=function __processStarOperator(array,path){var result=[];if(array&&_.isArray(array)&&array.length)for(var i=0,len=array.length;i<len;i++){var value;if(_.isArray(array[i]))value=[],array[i].forEach(function(nestedElement){value.push(eval("nestedElement"+path))});else{value=null;try{value=eval("array[i]"+path)}catch(e){console.warn(e)}}result.push(value)}return result};function dateDiff(e,t,r){if(date1format=getDateTimeFormat(e),date2format=getDateTimeFormat(t),r=__availableSpecs[r]||__defaultSpec,validateOperation(date1format,date2format,r))return e=(0,_moment2.default)(e,date1format),t=(0,_moment2.default)(t,date2format),e.diff(t,r);console.warn("Invalid inputs at dateDiff.")}function sum(e){var t=0;if(e&&_.isArray(e)&&e.length)for(var r=0,n=e.length;r<n;r++)e[r]&&(t+=e[r]);return t}function extract(e,t,r){e="string"==typeof e?e:e||"",t=t||",",r=r||0;var n=e.split(t)[r];return isNaN(n)?n:Number(n)}function flatten(e,t){return _.flatten(e,t)}function groupConcat(e,t){return t=void 0===t?", ":t,e.join(t)}function concat(){return Array.prototype.slice.call(arguments).join("")}function count(e){return e.length}function avg(e){var t=sum(e);return e&&_.isArray(e)&&e.length>0&&(t/=e.length),t}return function(formula,environment){return eval(formula)}}.call(),rules=[{pattern:"^=",replacement:""},{pattern:"'",replacement:"\\'"},{pattern:variablePattern,requiresContext:!0,replacement:function(e,t){variable=e[1];if(/\[(?!(?:@|\*|\d+)\]|[\.$])|^[^\[]*\]|\][^\[]*\]|[\{\}]/.test(variable))throw new Error;var r=_Helpers2.default.getPath(variable);variable="environment",variable.indexOf("::")>-1?variable+="["+metaDataVarName+"]":variable+="["+dataVarName+"]";for(var n=!1;r.length>0;)pathElement=r.shift(),"*"===pathElement?(n?variable+='")':n=!0,variable="__processStarOperator("+variable+', "'):variable+="["+pathElement+"]";return n&&(variable+='")'),variable}}],resolveReferences=function(e,t){},Formula=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));r._fieldPaths=[];for(var n={},a=0,o=rules.length;a<o;a++){var u=rules[a];e="function"==typeof u.replacement&&u.requiresContext?e.replace(new RegExp(u.pattern,"g"),function(){var e=u.replacement(arguments,context);return n[e]||(n[e]=this._fieldPaths.length,this._fieldPaths.push(e)),fieldPathsVarName+"["+n[e]+"]"}):e.replace(new RegExp(u.pattern,"g"),u.replacement)}return r._parsedExpression=e,r}return _inherits(t,_CompiledExpression3.default),_createClass(t,[{key:"eval",value:function(e,t,r){var n=_Helpers2.default.getPath(r),a=this._fieldPaths.map(function(e){return resolveReferences(e,n)}),o={};return o[dataVarName]=e,o[metaDataVarName]=t,o[fieldPathsVarName]=a,value=evalWithSafeEnvironment(this._parsedExpression,o),value}},{key:"getDependencies",value:function(){return this._fieldPaths.map(function(e){return e.split("::").shift()})}}],[{key:"isFormula",value:function(e){return"string"==typeof e&&0===e.indexOf("=")}}]),t}();exports.default=Formula},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=i(r(6)),o=i(r(3)),u=i(r(2));function i(e){return e&&e.__esModule?e:{default:e}}var l=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),a.default.isFormula(t)?this.compiledExpression=new a.default(t):o.default.isConcatenatedText(t)?this.compiledExpression=new o.default:this.compiledExpression=new u.default(t)}return n(e,[{key:"eval",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return this.compiledExpression.eval(e,t,r)}}],[{key:"isFormulaValue",value:function(e){return a.default.isFormula(e)||o.default.isConcatenatedText(e)}}]),e}();t.default=l}])});
//# sourceMappingURL=FormulaValue.js.map