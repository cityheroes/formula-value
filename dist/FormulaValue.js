!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("underscore"),require("moment")):"function"==typeof define&&define.amd?define(["underscore","moment"],t):"object"==typeof exports?exports.FormulaValue=t(require("underscore"),require("moment")):e.FormulaValue=t(e.underscore,e.moment)}(window,function(__WEBPACK_EXTERNAL_MODULE__3__,__WEBPACK_EXTERNAL_MODULE__6__){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=8)}([function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _underscore=__webpack_require__(3),_underscore2=_interopRequireDefault(_underscore),_moment=__webpack_require__(6),_moment2=_interopRequireDefault(_moment);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var getPath=function(e){if(!e)return[];for(var t=e.split(/\.|::/),r=[];t.length>0;){var n=t.shift();(n=n.replace(/(.*)\[(@|\*|\d+)]/g,function(e,t,n){return r.push(t),"@"!==n&&"*"!==n&&(n=Number(n)),r.push(n),""}))&&r.push(n)}return r},assignTo=function(e,t,r,n){var a=getPath(t);for(void 0!==r&&a.push(r);a.length;){var o=a.shift();if(a.length>0){if(!e[o]){var u=a[0];e[o]="number"==typeof u?[]:{}}e=e[o]}else e[o]=n}},compact=function(e,t){for(var r=getPath(t);r.length;){var n=r.shift();if(r.length>0){if(!e[n]){var a=r[0];e[n]="number"==typeof a?[]:{}}e=e[n]}else e[n]=_underscore2.default.compact(e[n])}},getDateTimeFormat=function(e){if(!e||"string"!=typeof e)return"";switch(e.length){case 10:return"YYYY-MM-DD";case 19:return"YYYY-MM-DD HH:mm:ss";case 8:return"HH:mm:ss";default:return""}},validateOperation=function(e,t,r){switch(r){case"years":case"months":case"weeks":case"days":if("HH:mm:ss"===e||"HH:mm:ss"===t)return!1;break;case"hours":case"minutes":case"seconds":if(("HH:mm:ss"===e||"HH:mm:ss"===t)&&e!==t)return!1}return!0},evalWithSafeEnvironment=function(){var __availableSpecs={Y:"years",M:"months",W:"weeks",D:"days",h:"hours",m:"minutes",s:"seconds",years:"years",months:"months",weeks:"weeks",days:"days",hours:"hours",minutes:"minutes",seconds:"seconds"},__defaultSpec="seconds",__processStarOperator=function __processStarOperator(array,path){var result=[];if(array&&_underscore2.default.isArray(array)&&array.length)for(var i=0,len=array.length;i<len;i++){var value;if(_underscore2.default.isArray(array[i]))value=[],array[i].forEach(function(nestedElement){value.push(eval("nestedElement"+path))});else{value=null;try{value=eval("array[i]"+path)}catch(e){console.warn(e)}}result.push(value)}return result};function dateDiff(e,t,r){var n=getDateTimeFormat(e),a=getDateTimeFormat(t);return r=__availableSpecs[r]||__defaultSpec,validateOperation(n,a,r)?(e=(0,_moment2.default)(e,n),t=(0,_moment2.default)(t,a),e.diff(t,r)):(console.warn("Invalid inputs at dateDiff."),null)}function sum(e){var t=0;if(e&&_underscore2.default.isArray(e)&&e.length)for(var r=0,n=e.length;r<n;r++)e[r]&&(t+=e[r]);return t}function extract(e,t,r){e="string"==typeof e?e:e||"",t=t||",",r=r||0;var n=e.split(t)[r];return isNaN(n)?n:Number(n)}function flatten(e,t){return _underscore2.default.flatten(e,t)}function groupConcat(e,t){return t=void 0===t?", ":t,e.join(t)}function concat(){return Array.prototype.slice.call(arguments).join("")}function count(e){return e.length}function avg(e){var t=sum(e);return e&&_underscore2.default.isArray(e)&&e.length>0&&(t/=e.length),t}return function(formula,data,metaData){return eval(formula)}}.call();exports.default={getPath:getPath,assignTo:assignTo,compact:compact,patterns:{variable:"{{([^}]+)}}"},dataVarName:"data",metaDataVarName:"metaData",evalWithSafeEnvironment:evalWithSafeEnvironment}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=u(r(3)),o=u(r(0));function u(e){return e&&e.__esModule?e:{default:e}}var i=/\[(?!(?:@|\*|\d+)\]|[\.$])|^[^\[]*\]|\][^\[]*\]|[\{\}]|\][]|\][^\.\[]/,s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._hasContext=!1,this._hasStar=!1,this._hasAt=!1;for(var r=o.default.getPath(t),n=void 0,a=r.length-1;a>=0;a--)"@"!==(n=r[a])&&"*"!==n?r[a]=n:(this._hasContext=!0,"*"===n?this._hasStar=!0:"@"===n&&(this._hasAt=!0));if(this._path=r,t.indexOf("::")>-1?this._environment=o.default.metaDataVarName:this._environment=o.default.dataVarName,""===t)this._parsedVariable="null";else if(!this._hasContext){for(var u=this._environment,i=0,s=r.length;i<s;i++)u+="['"+r[i]+"']";this._parsedVariable=u}}return n(e,[{key:"parseVariable",value:function(e){return this._parsedVariable||this._parseWithEnvironment(e)}},{key:"_parseWithEnvironment",value:function(e){for(var t=0,r=e.length,n=this._path.length,o=this._path;t<r&&t<n;t++)if("@"===o[t]&&a.default.isNumber(e[t]))o[t]=Number(e[t]);else if(o[t]!==e[t]||"*"===o[t])break;for(;t<n;t++){if("@"===o[t])throw new Error("Context could not fully resolve");"*"===o[t]&&(o[t]="*")}for(var u=void 0,i=!1,s=this._environment,l=0,f=this._path.length;l<f;l++)"*"===(u=this._path[l])?(i?s+='")':i=!0,s="__processStarOperator("+s+',"'):s+="['"+u+"']";return i&&(s+='")'),s}},{key:"hasStar",value:function(){return this._hasStar}},{key:"hasAt",value:function(){return this._hasAt}}],[{key:"isValid",value:function(e){return!i.test(e)}}]),e}();t.default=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=u(r(1)),o=u(r(0));function u(e){return e&&e.__esModule?e:{default:e}}var i=function(){function e(t,r){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._variables=[];for(var u={},i=0,s=t.length;i<s;i++){var l=t[i];r=r.replace(new RegExp(l.pattern,"g"),l.replacement)}this._parsedExpression=r.replace(new RegExp(o.default.patterns.variable,"g"),function(e,t){return a.default.isValid(t)?(u[t]||(u[t]=n._variables.length,n._variables.push(new a.default(t))),"[*"+u[t]+"*]"):"{{"+t+"}}"})}return n(e,[{key:"eval",value:function(){throw new Error("Eval is not implemented")}},{key:"getDependencies",value:function(){throw new Error("GetDependencies is not implemented")}}]),e}();t.default=i},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE__3__},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(2),u=(n=o)&&n.__esModule?n:{default:n};var i=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,[],""));return r.value=e,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.default),a(t,[{key:"eval",value:function(){return this.value}}]),t}();t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=u(r(0)),o=u(r(2));u(r(1));function u(e){return e&&e.__esModule?e:{default:e}}var i=[{pattern:"'",replacement:"\\'"}],s=new RegExp(a.default.patterns.variable),l=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),n(t,[{key:"eval",value:function(e,t,r){var n="";try{var o=a.default.getPath(r),u=this._variables.map(function(r){return r.hasStar()?"":a.default.evalWithSafeEnvironment(r.parseVariable(o),e,t)});n=this._parsedExpression.replace(/\[\*(\d*)\*\]/g,function(e,t){return u[parseInt(t)]})}catch(e){console.warn(e)}return n}},{key:"getDependencies",value:function(){return this._variables.map(function(e){return e.split("::").shift()})}}],[{key:"isConcatenatedText",value:function(e){return"string"==typeof e&&s.test(e)>-1}}]),t}();t.default=l},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE__6__},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=u(r(2)),o=(u(r(1)),u(r(0)));function u(e){return e&&e.__esModule?e:{default:e}}var i=[{pattern:"^=",replacement:""},{pattern:"'",replacement:"\\'"}],s=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),n(t,[{key:"eval",value:function(e,t,r){var n=null;try{var a=o.default.getPath(r),u=this._variables.map(function(e){return e.parseVariable(a)}),i=this._parsedExpression.replace(/\[\*(\d*)\*\]/g,function(e,t){return u[parseInt(t)]});n=o.default.evalWithSafeEnvironment(i,e,t)}catch(e){console.warn(e)}return n}},{key:"getDependencies",value:function(){return this._variables.map(function(e){return e.split("::").shift()})}}],[{key:"isFormula",value:function(e){return"string"==typeof e&&0===e.indexOf("=")}}]),t}();t.default=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=i(r(7)),o=i(r(5)),u=i(r(4));function i(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),a.default.isFormula(t)?this.compiledExpression=new a.default(t):o.default.isConcatenatedText(t)?this.compiledExpression=new o.default(t):this.compiledExpression=new u.default(t)}return n(e,[{key:"eval",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return this.compiledExpression.eval(e,t,r)}}],[{key:"isFormulaValue",value:function(e){return a.default.isFormula(e)||o.default.isConcatenatedText(e)}}]),e}();t.default=s}])});
//# sourceMappingURL=FormulaValue.js.map